{% extends 'users/users.html' %}

{% block content %}

<style>

    .box-shadow{
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
        border-radius: 12px;
    }
    .rowclass{
      margin-left: 5%;
      margin-right: 5%;
    }
    .properties{
        margin-bottom: 0;
    }
    .removeItem:hover{
        cursor: pointer;
    }
    .edit:hover{
        cursor: pointer;
    }
    .anchortag{
        text-decoration: none;
        color: black;
    }

</style>

<div class="row">
    <div class="col-sm-12">
        <section>
            <div class="container py-5">

              <div class="row">
                <div class="col-lg-4">
                  <div class="card mb-4">
                    <div class="card-body text-center box-shadow">
                      <img src="{{ user.profile.profile_image.url }}" alt="avatar"
                        class="rounded-circle img-fluid" style="width: 150px; height: 150px; object-fit: cover;">
                      <h5 class="my-3">{{ user.first_name }} {{ user.last_name }}</h5>
                      <div class="d-flex justify-content-center mb-2">
                        <a href="/users/profile/update">
                            <button type="button" class="btn btn-primary">Edit Profile</button>
                        </a>
                      </div>
                    </div>
                  </div>
                  <div class="card mb-4 mb-lg-0">
                    <div class="card-body p-0 box-shadow">
                      <ul class="list-group list-group-flush rounded-3">
                        <li class="list-group-item align-items-center p-3">
                            <a href="/cart/users/{{ user.id }}/cart" class="anchortag">
                                <p class="mb-0" style="padding-left: 30%;">
                                    <i class="fa-solid fa-cart-shopping" style="color: rgb(5, 133, 238); font-size: 17px; padding-right: 2%;" ></i>My Cart
                                </p>
                            </a>
                        </li>
                        <li class="list-group-item align-items-center p-3">
                            <a href="/cart/users/wishlist?user_id={{ user.id }}" class="anchortag">
                                <p class="mb-0" style="padding-left: 30%;">
                                    <i class='bi bi-heart-fill' style="font-size: 17px ; color: red; padding-right: 2%;" ></i>My WishList
                                </p>
                            </a>
                        </li>
                        <li class="list-group-item align-items-center p-3">
                            <a href="/cart/users/{{ user.id }}/orders" class="anchortag">
                                <p class="mb-0" style="padding-left: 30%;">
                                    <i class="bi bi-stack" style="font-size: 17px ; color: black; padding-right: 2%;"></i>My Orders
                                </p>
                            </a>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
                <div class="col-lg-8">
                  <div class="card mb-4">
                    <div class="card-body box-shadow">
                      <div class="row">
                        <div class="col-sm-3">
                          <p class="mb-0">First Name</p>
                        </div>
                        <div class="col-sm-9">
                          <p class="text-muted mb-0">{{ user.first_name }}</p>
                        </div>
                      </div>
                      <hr>
                      <div class="row">
                        <div class="col-sm-3">
                          <p class="mb-0">Last Name</p>
                        </div>
                        <div class="col-sm-9">
                          <p class="text-muted mb-0">{{ user.last_name }}</p>
                        </div>
                      </div>
                      <hr>
                      <div class="row">
                        <div class="col-sm-3">
                          <p class="mb-0">Phone</p>
                        </div>
                        <div class="col-sm-9">
                          <p class="text-muted mb-0">{{ user.profile.contact }}</p>
                        </div>
                      </div>
                      <hr>
                      <div class="row">
                        <div class="col-sm-3">
                          <p class="mb-0">State</p>
                        </div>
                        <div class="col-sm-9">
                          <p class="text-muted mb-0">{{ user.profile.state }}</p>
                        </div>
                      </div>
                      <hr>
                      <div class="row">
                        <div class="col-sm-3">
                          <p class="mb-0">City</p>
                        </div>
                        <div class="col-sm-9">
                          <p class="text-muted mb-0">{{ user.profile.city }}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-sm-12">
                        <div class="card">
                            <div class="card-body box-shadow">
                                <div class="row" style="margin-bottom: 4%;">
                                    <div class="col-sm-10" style="text-align: center;">
                                        <h4>Addresses</h4>
                                    </div>
                                    <div class="col-sm-2" style="text-align: right;">
                                        <a href="/users/add/address">
                                            <i class='bx bx-plus edit' style="color: #4f4ff3;
                                        font-size: 30px;" title="Add Address"></i>
                                        </a>
                                    </div>
                                </div>
                                <div class="row">

                                    {% for address in addresses %}
                                    <div class="col-sm-12" style="margin-bottom: 2%;">
                                        <div class="card">
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-sm-9">
                                                        <p style="margin: 0;">{{ address.detail_address }}</p>
                                                    </div>
                                                    <div class="col-sm-3" style="text-align: right;">
                                                        <div style="font-size: 19px;">
                                                            <a href="/users/address/update?address_id={{ address.id }}" class="anchortag">
                                                                <i class='bx bx-pencil edit' style="color: rgb(58, 235, 58); margin-right: 8px;" title="Update Address"></i>
                                                            </a>
                                                            <i class='bx bx-trash-alt edit' style="color: rgb(58, 235, 58);" title="Delete Address" onclick="deleteAddress('{{ address.id }}')"></i>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    {% endfor %}

                                </div>
                            </div>
                        </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>
    </div>
</div>
<p type = "text" id="csrf" style="display: none;">{% csrf_token %}</p>


<script>

function deleteAddress(address_id){
        Swal.fire({
            title: 'Do you want to remove this Address ?',
            showDenyButton: true,
            showCancelButton: false,
            confirmButtonText: 'Yes',
        }).then((result) => {
                if (result.isConfirmed) {
                    csrf_element = document.getElementsByName('csrfmiddlewaretoken')[0].value
                    const url = `/users/address/delete/${address_id}`;

                    fetch(url, {
                        method : 'DELETE',
                        headers : {
                            'Content-Type' : 'application/json',
                            "X-CSRFToken": csrf_element
                            },
                        }).then(response => {
                        console.log(response)
                        if(response.ok){
                            Swal.fire('Address Deleted :)', '', 'success').then(() => {
                                location.reload()
                            })
                        }
                        else{
                            console.log('errors')
                        }
                        }).catch(error => {
                        console.log(error)
                        })
                } 
                })
    }

</script>

{% endblock %}