{% extends 'base/sidebar.html' %}

{% block content %}

<style>
    @media (max-width: 767.98px) { .border-sm-start-none { border-left: none !important; } }

    .product-card:hover{
      cursor: pointer;
      background-color: rgb(245, 240, 240);
    }
</style>

<div class="row" style="margin-top: 2%; margin-left: 5%; margin-right: 5%;">
  <div class="col-sm-12">
      <section style="background-color: #eee; border-radius: 15px;">
          <div class="text-center container ">
            <p class="py-3" style="color:#59786e; font-size: 30px; font-weight: 400;"><strong>{{ category_name }}</strong></p>
        
            <div class="row">

              {% for product in products %}
              {% for variant in product_variant %}
              {% if variant.product.id == product.product.id %}
              <div class="col-lg-3 col-md-12 mb-4">
                <div class="card product-card" >
                  <div class="row">
                      <div class="col-sm-12" style="text-align: right;">
                        {% if product.status %}
                        <a href="#" style="text-decoration: none; padding-right: 4%;">
                          <i class="bi bi-heart-fill wishlist" style="font-size: 20px; color:#f30909" title="Remove from WishList" onclick="removeFromWishList('{{ user.id }}','{{ variant.id }}')" ></i>
                        </a>
                        {% else %}
                        <a href="#" style="text-decoration: none; padding-right: 4%;">
                          <i class="bi bi-heart wishlist" style="font-size: 20px; color:#f30909" title="Add to WishList" onclick="addToWishList('{{ user.id }}','{{ variant.id }}')" ></i>
                        </a>
                        {% endif %}
                      </div>
                  </div>
                  <a href="/products/{{ product.product.id }}/details?user_id={{ user.id }}" class="text-reset anchortag">
                    <div class="bg-image hover-zoom ripple ripple-surface ripple-surface-light"
                      data-mdb-ripple-color="light">
                      <img src="{{ variant.image.url }}"
                        class="w-100" height="150px" style="object-fit: contain;"/>
                    </div>
                    <div class="card-body" style="color: #837a7a;">
                        <h5 class="card-title mb-3" style="color:#3e3b3b">{{ product.product.name }}</h5>
                        <p>Rs. {{ variant.price }}</p>
                        <div style="color:#3e3b3b">4.6/5 (223)</div>
                        <div class="stars">
                          <i class="bi bi-star-fill" style="color: rgb(21, 194, 21)"></i>
                          <i class="bi bi-star-fill" style="color: rgb(21, 194, 21)"></i>
                          <i class="bi bi-star-fill" style="color: rgb(21, 194, 21)"></i>
                          <i class="bi bi-star-fill" style="color: rgb(21, 194, 21)"></i>
                          <i class="bi bi-star-half" style="color: rgb(21, 194, 21)"></i>
                        </div>
                        
                    </div>
                  </a>
                </div>
              </div>
              {% endif %}
              {% endfor %}
              {% endfor %}

            </div>
          </div>
      </section>
  </div>
</div><br>
<p type = "text" id="csrf" style="display: none;">{% csrf_token %}</p>


<script>

function addToWishList(user_id,variant_id){

      console.log(user_id,variant_id)

      csrf_element = document.getElementsByName('csrfmiddlewaretoken')[0].value
      const url = `http://127.0.0.1:8000/cart/users/${user_id}/wishlist/add`;
      const data = {
        "user" : user_id,
        "product_variant" : variant_id,
      }

      fetch(url, {
        method : 'POST',
        headers : {
            'Content-Type' : 'application/json',
            "X-CSRFToken": csrf_element
            },
        body : JSON.stringify(data)
      }).then(response => {
        console.log(response)
        if(response.ok){
          Swal.fire('Added to wishList :)', '', 'success').then( () => {
            location.reload()
          })
        }
        else{
          console.log('errors')
        }
      }).catch(error => {
        console.log(error)
      }) 

  }

function removeFromWishList(user_id,variant_id){
    console.log(user_id,variant_id)

    csrf_element = document.getElementsByName('csrfmiddlewaretoken')[0].value
    const url = `http://127.0.0.1:8000/cart/users/${user_id}/wishlist/delete`;
    const data = {
      "user" : user_id,
      "product_variant" : variant_id,
    }

    fetch(url, {
      method : 'POST',
      headers : {
          'Content-Type' : 'application/json',
          "X-CSRFToken": csrf_element
          },
      body : JSON.stringify(data)
    }).then(response => {
      console.log(response)
      if(response.ok){
        Swal.fire('Removed from Wishlist :(', '', 'success').then( () => {
          location.reload()
        })
      }
      else{
        console.log('errors')
      }
    }).catch(error => {
      console.log(error)
    }) 
}



</script>

{% endblock %}


{% block non_auth_content %}
{% if not user.is_authenticated %}

<style>
  @media (max-width: 767.98px) { .border-sm-start-none { border-left: none !important; } }

  .product-card:hover{
    cursor: pointer;
    background-color: rgb(245, 240, 240);
  }
</style>

<div class="row" style="margin-top: 2%; margin-left: 5%; margin-right: 5%;">
<div class="col-sm-12">
    <section style="background-color: #eee; border-radius: 15px;">
        <div class="text-center container ">
          <p class="py-3" style="color:#59786e; font-size: 30px; font-weight: 400;"><strong>{{ category_name }}</strong></p>
      
          <div class="row">

            {% for product in products %}
            {% for variant in product_variant %}
            {% if variant.product.id == product.product.id %}
            <div class="col-lg-3 col-md-12 mb-4">
              <div class="card product-card" >
                <div class="row">
                    <div class="col-sm-12" style="text-align: right;">
                      {% if product.status %}
                      <a href="#" style="text-decoration: none; padding-right: 4%;">
                        <i class="bi bi-heart-fill wishlist" style="font-size: 20px; color:#f30909" title="Remove from WishList" onclick="removeFromWishList('{{ user.id }}','{{ variant.id }}')" ></i>
                      </a>
                      {% else %}
                      <a href="#" style="text-decoration: none; padding-right: 4%;">
                        <i class="bi bi-heart wishlist" style="font-size: 20px; color:#f30909" title="Add to WishList" onclick="login()" ></i>
                      </a>
                      {% endif %}
                    </div>
                </div>
                <a href="/products/{{ product.product.id }}/details?user_id={{ user.id }}" class="text-reset anchortag">
                  <div class="bg-image hover-zoom ripple ripple-surface ripple-surface-light"
                    data-mdb-ripple-color="light">
                    <img src="{{ variant.image.url }}"
                      class="w-100" height="150px" style="object-fit: contain;"/>
                  </div>
                  <div class="card-body" style="color: #837a7a;">
                      <h5 class="card-title mb-3" style="color:#3e3b3b">{{ product.product.name }}</h5>
                      <p>Rs. {{ variant.price }}</p>
                      <div style="color:#3e3b3b">4.6/5 (223)</div>
                      <div class="stars">
                        <i class="bi bi-star-fill" style="color: rgb(21, 194, 21)"></i>
                        <i class="bi bi-star-fill" style="color: rgb(21, 194, 21)"></i>
                        <i class="bi bi-star-fill" style="color: rgb(21, 194, 21)"></i>
                        <i class="bi bi-star-fill" style="color: rgb(21, 194, 21)"></i>
                        <i class="bi bi-star-half" style="color: rgb(21, 194, 21)"></i>
                      </div>
                      
                  </div>
                </a>
              </div>
            </div>
            {% endif %}
            {% endfor %}
            {% endfor %}

          </div>
        </div>
    </section>
</div>
</div><br>


<script>
function login(){
  Swal.fire('Please login or SignUp')
}
</script>

{% endif %}
{% endblock %}